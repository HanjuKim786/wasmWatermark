<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" src="/src/style/bootstrap.min.css">
    <link rel="stylesheet" href="/src/style/common.css">
    
    <script src="./src/js/lib/jquery-3.6.0.min.js"></script>
    <script src="/src/js/lib/bootstrap.min.js"></script>
    <script src="./src/js/lib/jimp.min.js"></script>
    
    <!-- Load TensorFlow.js. This is required to use MobileNet. -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.1"> </script>
    <!-- Load the MobileNet model. -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@1.0.0"> </script>

    <script src="./src/js/index.js"></script>
    <title>Watermark</title>
</head>
<body>
  <p>
    <input type="file" id="input" onchange="window.newFiles(this)"/>
  </p>
  
  <div class="container" style="margin-top:50px;">
    <div>
      Original
      <div>
        <img id="originImg" />
      </div>
      
    </div>
    <div>
      result(javascript)
      <div>
        <img id="jsResult" />
      </div>
      time of watermark insertion :
      <span id="spentTime1"></span>
    </div>
    <div>
      result(Webassembly)
      <div>
        <img id="wasmResult" />
      </div>
      time of watermark insertion :
      <span id="spentTime2"></span>
    </div>
  </div>
  <div class="tags">
    tags by using tensorflow.js
    ex)
    <div class="tag">
      #object
    </div>
    <div class="tag">
      #cup
    </div>
    <div class="tag">
      #pen
    </div>
    <div class="tag">
      #watch
    </div>
    <di class="tag">
      #etc...
    </div>
  </div>


  <script>
    window.onload = function(){
      window.App = new App();
      window.newFiles = function newFiles(element){
        window.App.readFileAndProcess(element.files[0]);
        
        $('#originImg').on('load',(e)=>{
          let img = document.getElementById("originImg");
          const model = mobilenet.load();

          model.then(o=>{
            const predictions = o.classify(img);
            predictions.then((o)=>{
              console.log(o);
                $.each(o,(index, value)=>{
                  let list = value['className'].split(',');
                  for(let i = 0; i <= list.length-1; i++){
                    $('.tags').append('<button type="button" class="btn btn-primary tag">#' + list[i] + "</button>")
                  }
                });
            });
          })

          
        });
      } 

      $("#input").on("change",(e)=>{
        var reader = new FileReader();

        reader.onload = function (e) {
           $('#originImg').attr('src', e.target.result);

        }
       reader.readAsDataURL(input.files[0]);
      })
    }
  </script>
  <script src="./src/wasm/wasmwatermark.js"></script>
</body>
</html>